<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UT App</title>

<style>
body{
background:#111;
color:white;
font-family:sans-serif;
margin:0;
padding:10px;
}

.controls{
display:flex;
flex-direction:column;
gap:10px;
}

input{
font-size:18px;
padding:8px;
}

button{
font-size:20px;
padding:10px;
background:#00aaff;
color:white;
border:none;
border-radius:8px;
}

canvas{
width:100%;
height:auto;
background:#222;
margin-top:10px;
border-radius:10px;
}
</style>
</head>

<body>

<div class="controls">
板厚(mm)
<input type="number" id="thickness" value="12">

探触子位置(mm)
<input type="number" id="probeX" value="20">

角度(°)
<input type="range" id="angle" min="30" max="80" value="60" oninput="draw()">
<span id="angleValue">60</span>°

ビーム経路長(mm)
<input type="number" id="pathLength" value="30">

<button onclick="draw()">表示</button>
</div>

<canvas id="canvas" width="500" height="360"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const gap = 6;
const scale = 8;
const rootX = 250;
const topY = 120;

function draw(){

ctx.clearRect(0,0,canvas.width,canvas.height);

const t = parseFloat(document.getElementById("thickness").value);
const probe = parseFloat(document.getElementById("probeX").value);
const angleDeg = parseFloat(document.getElementById("angle").value);
const pathLength = parseFloat(document.getElementById("pathLength").value);

document.getElementById("angleValue").innerText = angleDeg;

const angleRad = angleDeg * Math.PI / 180;

const bottomY = topY + t * scale;
const a = (t / Math.tan(60 * Math.PI / 180)) * scale;

// 開先図
ctx.strokeStyle="red";
ctx.lineWidth=2;

ctx.beginPath();
ctx.moveTo(rootX - gap*scale - 40, 40);
ctx.lineTo(rootX - gap*scale - 40, 380);
ctx.stroke();

ctx.beginPath();
ctx.moveTo(rootX, 40);
ctx.lineTo(rootX, 380);
ctx.stroke();

ctx.beginPath();
ctx.moveTo(rootX, topY);
ctx.lineTo(600, topY);
ctx.stroke();

ctx.beginPath();
ctx.moveTo(rootX, bottomY);
ctx.lineTo(600, bottomY);
ctx.stroke();

ctx.beginPath();
ctx.moveTo(rootX, topY);
ctx.lineTo(rootX + a, topY);
ctx.lineTo(rootX, bottomY);
ctx.stroke();

// ビーム（直射＋1回反射）
let currentX = rootX + probe * scale;
let currentY = topY;

let remaining = pathLength * scale;

let dx = -Math.sin(angleRad);
let dy = Math.cos(angleRad);

ctx.strokeStyle="yellow";
ctx.beginPath();
ctx.moveTo(currentX,currentY);

for(let i=0;i<2;i++){

let travel;

if(dy>0){
travel=(bottomY-currentY)/dy;
}else{
travel=(topY-currentY)/dy;
}

if(remaining<=travel){
currentX+=dx*remaining;
currentY+=dy*remaining;
ctx.lineTo(currentX,currentY);
break;
}

currentX+=dx*travel;
currentY+=dy*travel;
ctx.lineTo(currentX,currentY);

remaining-=travel;
dy=-dy;
}

ctx.stroke();
}

draw();
</script>

</body>
</html>
